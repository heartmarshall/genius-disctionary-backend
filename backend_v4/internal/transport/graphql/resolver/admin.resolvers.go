package resolver

// This file will be automatically regenerated based on the schema, any resolver
// implementations
// will be copied through when generating and any unknown code will be moved to the end.
// Code generated by github.com/99designs/gqlgen version v0.17.86

import (
	"context"

	"github.com/google/uuid"
	"github.com/heartmarshall/myenglish-backend/internal/domain"
	"github.com/heartmarshall/myenglish-backend/internal/transport/graphql/generated"
	"github.com/heartmarshall/myenglish-backend/internal/transport/middleware"
)

// Status is the resolver for the status field.
func (r *enrichmentQueueItemResolver) Status(ctx context.Context, obj *domain.EnrichmentQueueItem) (string, error) {
	return string(obj.Status), nil
}

// AdminSetUserRole is the resolver for the adminSetUserRole field.
func (r *mutationResolver) AdminSetUserRole(ctx context.Context, userID uuid.UUID, role string) (*domain.User, error) {
	return r.user.SetUserRole(ctx, userID, domain.UserRole(role))
}

// EnrichmentQueueStats is the resolver for the enrichmentQueueStats field.
func (r *queryResolver) EnrichmentQueueStats(ctx context.Context) (*domain.EnrichmentQueueStats, error) {
	if err := middleware.RequireAdmin(ctx); err != nil {
		return nil, err
	}
	stats, err := r.enrichment.GetStats(ctx)
	if err != nil {
		return nil, err
	}
	return &stats, nil
}

// EnrichmentQueue is the resolver for the enrichmentQueue field.
func (r *queryResolver) EnrichmentQueue(ctx context.Context, status *string, limit *int, offset *int) ([]*domain.EnrichmentQueueItem, error) {
	if err := middleware.RequireAdmin(ctx); err != nil {
		return nil, err
	}

	s := ""
	if status != nil {
		s = *status
	}
	l := 50
	if limit != nil {
		l = *limit
	}
	o := 0
	if offset != nil {
		o = *offset
	}

	items, err := r.enrichment.List(ctx, s, l, o)
	if err != nil {
		return nil, err
	}

	result := make([]*domain.EnrichmentQueueItem, len(items))
	for i := range items {
		result[i] = &items[i]
	}
	return result, nil
}

// AdminUsers is the resolver for the adminUsers field.
func (r *queryResolver) AdminUsers(ctx context.Context, limit *int, offset *int) (*generated.AdminUsersResult, error) {
	if err := middleware.RequireAdmin(ctx); err != nil {
		return nil, err
	}

	l, o := 50, 0
	if limit != nil {
		l = *limit
	}
	if offset != nil {
		o = *offset
	}

	users, total, err := r.user.ListUsers(ctx, l, o)
	if err != nil {
		return nil, err
	}

	ptrs := make([]*domain.User, len(users))
	for i := range users {
		ptrs[i] = &users[i]
	}

	return &generated.AdminUsersResult{Users: ptrs, Total: total}, nil
}

// EnrichmentQueueItem returns generated.EnrichmentQueueItemResolver implementation.
func (r *Resolver) EnrichmentQueueItem() generated.EnrichmentQueueItemResolver {
	return &enrichmentQueueItemResolver{r}
}

type enrichmentQueueItemResolver struct{ *Resolver }
